
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Building the Root File System &#8212; PandABlocks-rootfs 3.1a5 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=4a1c6285" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=af5b42bb"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=30646c52"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'how-to/building';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.4';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://PandABlocks.github.io/PandABlocks-rootfs/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '3.1a5';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Updating a PandA via SSH" href="remote.html" />
    <link rel="prev" title="PandABlocks-rootfs" href="../index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/PandA-logo-for-black-background.svg" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../_static/PandA-logo-for-black-background.svg" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">PandABlocks-rootfs</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="#">
    Building the Root File System
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="remote.html">
    Updating a PandA via SSH
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="quickstart.html">
    Getting a PandA on the network
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PandABlocks/PandABlocks-rootfs" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/PandABlocks-rootfs" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="#">
    Building the Root File System
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="remote.html">
    Updating a PandA via SSH
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="quickstart.html">
    Getting a PandA on the network
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PandABlocks/PandABlocks-rootfs" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/PandABlocks-rootfs" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fas fa-cube fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Building...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="building-the-root-file-system">
<h1>Building the Root File System<a class="headerlink" href="#building-the-root-file-system" title="Link to this heading">#</a></h1>
<p>This project builds a complete system image for booting PandA. The following components are built in turn:</p>
<ul class="simple">
<li><p>The U-Boot boot loader is built and assembled together with the Zynq stage-1 boot loader.</p></li>
<li><p>The Linux kernel is built.</p></li>
<li><p>Two target root file systems are assembled: one for final system bootstrapping, one to act as the final system.</p></li>
</ul>
<section id="build-dependencies">
<h2>Build Dependencies<a class="headerlink" href="#build-dependencies" title="Link to this heading">#</a></h2>
<p>The following must be installed before building this project:</p>
<ul class="simple">
<li><p>Xilinx Zynq SDK.</p></li>
<li><p>U-Boot and Linux kernel sources. This project requires the Xilinx branches of these projects.</p></li>
<li><p>The Diamond rootfs builder. This can be downloaded from <a class="reference external" href="https://github.com/araneidae/rootfs">github.com/araneidae/rootfs</a></p></li>
<li><p>Sources needed for rootfs build. This list is quite long, see below.</p></li>
</ul>
<section id="configuring-config">
<h3>Configuring <code class="docutils literal notranslate"><span class="pre">CONFIG</span></code><a class="headerlink" href="#configuring-config" title="Link to this heading">#</a></h3>
<p>All of the build dependencies are configured in the file <code class="docutils literal notranslate"><span class="pre">CONFIG</span></code>. This is designed to not be under version control. Copy the file <code class="docutils literal notranslate"><span class="pre">CONFIG.example</span></code> and modify the following fields as required:</p>
<p><code class="docutils literal notranslate"><span class="pre">PANDA_ROOT</span></code>:
All of the build dependencies are configured in the file CONFIG. This is designed to not be under version control. Copy the file CONFIG.example and modify the following fields as required:
<code class="docutils literal notranslate"><span class="pre">TAR_FILES</span></code>:
All of the source files require to build the system will be looked for in this directory. This can also be a list of directories if necessary.
<code class="docutils literal notranslate"><span class="pre">SDK_ROOT</span></code>:
Location of the Xilinx SDK that will be used to build the system.
<code class="docutils literal notranslate"><span class="pre">ROOTFS_TOP</span></code>:
This needs to point to the root directory of the Diamond rootfs builder, download from the github location given above.</p>
<p>Three files and directories are taken from <code class="docutils literal notranslate"><span class="pre">SDK_ROOT</span></code>, and they can instead be specified directly. Note that in this case <code class="docutils literal notranslate"><span class="pre">SDK_ROOT</span></code> must not be set.</p>
<p><code class="docutils literal notranslate"><span class="pre">BOOT_GEN</span></code>:
This is the path to a Xilinx toolchain tool used to build the <code class="docutils literal notranslate"><span class="pre">boot.bin</span></code> file. By default this is set to <code class="docutils literal notranslate"><span class="pre">$(SDK_ROOT)/bin/bootgen</span></code>.
<code class="docutils literal notranslate"><span class="pre">BINUTILS_DIR</span></code>:
This is the path to the gcc cross-compiler toolchain to use. By default this is set to <code class="docutils literal notranslate"><span class="pre">$(SDK_ROOT)/gnu/arm/lin</span></code>. The directory <code class="docutils literal notranslate"><span class="pre">$(BINUTILS_DIR)/bin</span></code> will be added to the path during the build.
<code class="docutils literal notranslate"><span class="pre">SYSROOT</span></code>:
This is the path to the compiled system root (derived from libc). Normally this is part of the installed toolchain, and if not set elsewhere this is set to <code class="docutils literal notranslate"><span class="pre">$(BINUTILS_DIR)/$(COMPILER_PREFIX)/libc</span></code>.</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">COMPILER_PREFIX</span></code> symbol can also be overwritten if required. The default value is <code class="docutils literal notranslate"><span class="pre">arm-xilinx-linux-gnueabi</span></code>.</p>
</section>
<section id="sources">
<h3>Sources<a class="headerlink" href="#sources" title="Link to this heading">#</a></h3>
<p>The rootfs requires a long list of dependencies that are freely available on the web. They have been gathered together in one tar file here:</p>
<p><a class="reference external" href="http://www.ohwr.org/attachments/download/5133/rootfs-tarfiles-0.6.tar">rootfs-tarfiles-0.6.tar</a></p>
<p>They consist of the following sources, listed below with their MD5 checksums:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>

<span class="mi">930</span><span class="n">d126df2113221e63c4ec4ce356f2c</span> <span class="n">linux</span><span class="o">-</span><span class="n">xilinx</span><span class="o">-</span><span class="n">v2015</span><span class="mf">.1</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">b6d212208b7694f748727883eebaa74e</span> <span class="n">u</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">xlnx</span><span class="o">-</span><span class="n">xilinx</span><span class="o">-</span><span class="n">v2015</span><span class="mf">.1</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>

<span class="mi">82</span><span class="n">d05e03b93e45f5a39b828dc9c6c29b</span> <span class="n">autoconf</span><span class="o">-</span><span class="mf">2.69</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="mi">716946</span><span class="n">a105ca228ab545fc37a70df3a3</span> <span class="n">automake</span><span class="o">-</span><span class="mf">1.15</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="mi">0</span><span class="n">b65a216ce9dc9c1a7e20a729dd7c05b</span> <span class="n">backports_abc</span><span class="o">-</span><span class="mf">0.4</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="mi">788214</span><span class="n">f20214c64631f0859dc79f23c6</span> <span class="n">backports</span><span class="o">.</span><span class="n">ssl_match_hostname</span><span class="o">-</span><span class="mf">3.4.0.2</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="mi">7925683</span><span class="n">d7dd105aabe9b6b618d48cc73</span> <span class="n">busybox</span><span class="o">-</span><span class="mf">1.23.2</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">bz2</span>
<span class="n">bb13834970c468f73415618437f3feac</span> <span class="n">conserver</span><span class="o">-</span><span class="mf">8.2.0</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="mi">5</span><span class="n">d69a1b712fb8fec6ad461e676bf1097</span> <span class="n">cothread</span><span class="o">-</span><span class="mf">2.14</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">e967e320344cd4bfebe321e3ab8514d6</span> <span class="n">dropbear</span><span class="o">-</span><span class="mf">2015.67</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">bz2</span>
<span class="n">bc759fc62666786f5436e2075beb3265</span> <span class="n">e2fsprogs</span><span class="o">-</span><span class="mf">1.42.13</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">ac80f432ac9373e7d162834b264034b6</span> <span class="n">enum34</span><span class="o">-</span><span class="mf">1.0.4</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="mi">3</span><span class="n">b2322695e9ee7bf447ebcdb85f93e83</span> <span class="n">ethtool</span><span class="o">-</span><span class="mf">2.6.36</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="mi">5154</span><span class="n">c00201d599acc00194c6c278ca23</span> <span class="n">iperf</span><span class="o">-</span><span class="mf">3.0.2</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="mf">277e4</span><span class="n">bd258fd4fb2aadaed760320c566</span> <span class="n">libressl</span><span class="o">-</span><span class="mf">2.2.0</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">addf44b646ddb4e3919805aa88fa7c5e</span> <span class="n">libtool</span><span class="o">-</span><span class="mf">2.4.6</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="mi">1</span><span class="n">b29c10db4aa88afcaeeaabeef6790db</span> <span class="n">lsof_4</span><span class="mf">.88</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">bz2</span>
<span class="n">a5e9954b1dae036762f7b13673a2cf76</span> <span class="n">m4</span><span class="o">-</span><span class="mf">1.4.17</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="mi">4</span><span class="n">ad1f758d49615efe14edb107eddac5c</span> <span class="n">mtd</span><span class="o">-</span><span class="n">utils</span><span class="o">-</span><span class="mf">1.5.1</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">bz2</span>
<span class="mi">1</span><span class="n">c612b478f976abf8ef926480c7a3684</span> <span class="n">nano</span><span class="o">-</span><span class="mf">2.4.1</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="mi">8</span><span class="n">cb9c412e5f2d96bc6f459aa8c6282a1</span> <span class="n">ncurses</span><span class="o">-</span><span class="mf">5.9</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">fa37049383316322d060ec9061ac23a9</span> <span class="n">ntp</span><span class="o">-</span><span class="mf">4.2.8</span><span class="n">p2</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">a1ed53432dbcd256398898d35bc8e645</span> <span class="n">numpy</span><span class="o">-</span><span class="mf">1.9.2</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">aa3c86e67551adc3ac865160e34a2a0d</span> <span class="n">pkg</span><span class="o">-</span><span class="n">config</span><span class="o">-</span><span class="mf">0.28</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">bbf052e7fcc6fa403d2514219346da04</span> <span class="n">procServ</span><span class="o">-</span><span class="mf">2.6.0</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">d7547558fd673bd9d38e2108c6b42521</span> <span class="n">Python</span><span class="o">-</span><span class="mf">2.7.10</span><span class="o">.</span><span class="n">tgz</span>
<span class="mi">33</span><span class="n">c8fb279e981274f485fd91da77e94a</span> <span class="n">readline</span><span class="o">-</span><span class="mf">6.3</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="mi">419</span><span class="n">a0594e2b25039239af8b90eda7d92</span> <span class="n">screen</span><span class="o">-</span><span class="mf">4.2.1</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">af2fc6a3d6cc5a02d0bf54d909785fcb</span> <span class="n">singledispatch</span><span class="o">-</span><span class="mf">3.4.0.3</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="mi">107</span><span class="n">a5be455493861189e9b57a3a51912</span> <span class="n">strace</span><span class="o">-</span><span class="mf">4.10</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">xz</span>
<span class="n">d13a99dc0b60ba69f5f8ec1235e5b232</span> <span class="n">tornado</span><span class="o">-</span><span class="mf">4.3</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="mi">44</span><span class="n">d667c142d7cda120332623eab69f40</span> <span class="n">zlib</span><span class="o">-</span><span class="mf">1.2.8</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>These packages are used as follows in the build:</p>
<p><code class="docutils literal notranslate"><span class="pre">autoconf,</span> <span class="pre">automake,</span> <span class="pre">libtool,</span> <span class="pre">m4,</span> <span class="pre">pkg-config</span></code>:
The rootfs builder needs specific and up to date versions of these tools.</p>
<p><code class="docutils literal notranslate"><span class="pre">busybox</span></code>:
The entire target system environment is run with busybox.</p>
<p><code class="docutils literal notranslate"><span class="pre">e2fsprogs,</span> <span class="pre">mtd-utils</span></code>:
These packages are needed by the initramfs bootstrap process.</p>
<p><code class="docutils literal notranslate"><span class="pre">dropbear,</span> <span class="pre">ntp</span></code>:
These provide fundamental target resources: dropbear provides an ssh server, ntp is used for accurate timestamps.</p>
<p><code class="docutils literal notranslate"><span class="pre">Python,</span> <span class="pre">enum34,</span> <span class="pre">libressl,</span> <span class="pre">numpy,</span> <span class="pre">cothread,</span> <span class="pre">ws4py</span></code>:
Python and a variety of supporting libraries will be used for running a number of system components.</p>
<p><code class="docutils literal notranslate"><span class="pre">conserver,</span> <span class="pre">procServ,</span> <span class="pre">screen</span></code>:
It is possible that these may be used for server management.</p>
<p><code class="docutils literal notranslate"><span class="pre">ethtool,</span> <span class="pre">iperf,</span> <span class="pre">lsof,</span> <span class="pre">strace,</span> <span class="pre">nano</span></code>:
These are useful debugging utilities, together with an easy to use editor.</p>
<p><code class="docutils literal notranslate"><span class="pre">ncurses,</span> <span class="pre">readline,</span> <span class="pre">zlib</span></code>:
These are all libraries used by some of the packages above.</p>
</section>
</section>
<section id="output-files">
<h2>Output Files<a class="headerlink" href="#output-files" title="Link to this heading">#</a></h2>
<p>When built the following files are placed in <code class="docutils literal notranslate"><span class="pre">$(BOOT_IMAGE)</span></code> (see <code class="docutils literal notranslate"><span class="pre">CONFIG</span></code> to define this):</p>
<p><code class="docutils literal notranslate"><span class="pre">boot.bin</span></code>:
This file is loaded by the Zynq stage-0 boot loader and contains a standard stage 1 boot loader together with U-Boot, which acts as the stage-2 boot loader.</p>
<p><code class="docutils literal notranslate"><span class="pre">uEnv.txt</span></code>:
This is read by U-Boot to override a couple of default boot settings.</p>
<p><code class="docutils literal notranslate"><span class="pre">uImage</span></code>:
This is the Linux kernel image loaded by U-Boot.</p>
<p><code class="docutils literal notranslate"><span class="pre">devicetree.dtb</span></code>:
This is passed to the kernel to define the system hardware resources.</p>
<p><code class="docutils literal notranslate"><span class="pre">uinitramfs</span></code>:
This is the initial user-space system executed by the kernel.</p>
<p><code class="docutils literal notranslate"><span class="pre">imagefile.cpio.gz</span></code>:
This file will be used to prepare the initial state of the file system.</p>
<p><code class="docutils literal notranslate"><span class="pre">config.txt</span></code>:
This is designed to be user editable and contains network configuration settings.</p>
</section>
<section id="boot-process">
<h2>Boot Process<a class="headerlink" href="#boot-process" title="Link to this heading">#</a></h2>
<p>The boot process is as follows:</p>
<ol class="arabic simple" start="0">
<li><p>The stage-0 boot loader is hard wired into Zynq. This loads boot.bin from the SD card into memory and executes the next step.</p></li>
<li><p>The stage-1 boot loader loads U-Boot from the boot.bin file.</p></li>
<li><p>The stage-2 boot loader is U-Boot. This loads the kernel into memory together with the device tree and initial ram filesystem image.</p></li>
<li><p>The kernel initialises hardware resources and then prepares the initial file system image loaded from uinitramfs. The init script in this image is executed.</p></li>
<li><p>The initial init script checks the configuration and prompts for a MAC address if necessary, and repartitions the SD card if necessary before uncompressing imagefile.cpio.gz onto the target system.</p></li>
<li><p>Finally the target system is executed.</p></li>
</ol>
</section>
<section id="preparing-sd-for-install">
<h2>Preparing SD for Install<a class="headerlink" href="#preparing-sd-for-install" title="Link to this heading">#</a></h2>
<p>To install a fresh PandA system:</p>
<ol class="arabic simple">
<li><p>Obtain a formatted empty SD card. A minimum size of 2GB is recommended.</p></li>
<li><p>Place the following files on the SD card (from rootfs build):</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">boot</span><span class="o">.</span><span class="n">bin</span>    <span class="n">devicetree</span><span class="o">.</span><span class="n">dtb</span>     <span class="n">uEnv</span><span class="o">.</span><span class="n">txt</span>  <span class="n">uinitramfs</span>
<span class="n">config</span><span class="o">.</span><span class="n">txt</span>  <span class="n">imagefile</span><span class="o">.</span><span class="n">cpio</span><span class="o">.</span><span class="n">gz</span>  <span class="n">uImage</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Allocate MAC address to target system. These need to be purchased in blocks.</p></li>
<li><p>(Optionally) Write MAC address into a file named <code class="docutils literal notranslate"><span class="pre">MAC</span></code> on the SD card.</p></li>
</ol>
</section>
<section id="panda-system-first-boot">
<h2>Panda System First Boot<a class="headerlink" href="#panda-system-first-boot" title="Link to this heading">#</a></h2>
<p>It is wise to boot PandA for the first time with an connected serial console, particularly if the MAC file has not been written. If no MAC file has been specified then on boot the serial console will prompt for a MAC address to be specified:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">------------------------------------</span>
<span class="n">Enter</span> <span class="n">MAC</span> <span class="n">address</span><span class="p">:</span>
</pre></div>
</div>
<p>The SD card will then be repartitioned, the content of <code class="docutils literal notranslate"><span class="pre">imagefile.cpio.gz</span></code> will be installed and this file is deleted.</p>
<p>The installation process takes a couple of minutes or so, depending somewhat on the speed of the SD card.</p>
<p>The serial port parameters are 115200n8.</p>
</section>
<section id="panda-packages-zpkg">
<h2>PandA Packages (zpkg)<a class="headerlink" href="#panda-packages-zpkg" title="Link to this heading">#</a></h2>
<p>zpkg files will be used for managing all application software. A zpkg is defined by the following:</p>
<ul class="simple">
<li><p>The name of a zpkg file must be of the form package&#64;version.zpg, where package is the package name and version identifies the package version.</p></li>
<li><p>A zpkg file is simply a gzipped tar file containing files to be installed under /opt.</p></li>
<li><p>A startup script, if required, must be present in the zpkg under etc/init.d and linked from etc/rc.d.</p></li>
</ul>
</section>
<section id="installing-zpkg-files">
<h2>Installing zpkg Files<a class="headerlink" href="#installing-zpkg-files" title="Link to this heading">#</a></h2>
<p>There are two ways to maintain installed software:</p>
<ol class="arabic simple">
<li><p>The simplest is via the Administration web page:</p></li>
</ol>
<ul class="simple">
<li><p>First place the .zpg files to install on a USB stick.</p></li>
<li><p>Insert USB stick into PandA</p></li>
<li><p>Select “Install zpg files from USB” from admin page</p></li>
<li><p>Navigate to appropriate location and select package(s) to install</p></li>
<li><p>Click on “Install Selected”</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>Alternatively files can be copied directly to PandA and installed via a script, for example:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scp</span> <span class="n">panda</span><span class="o">-</span><span class="n">fpga</span><span class="nd">@version</span><span class="o">.</span><span class="n">zpg</span> <span class="n">root</span><span class="nd">@panda</span><span class="p">:</span><span class="o">/</span><span class="n">tmp</span>
<span class="n">ssh</span> <span class="n">root</span><span class="nd">@panda</span> <span class="n">zpkg</span> <span class="n">install</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">panda</span><span class="o">-</span><span class="n">fpga</span><span class="nd">@version</span><span class="o">.</span><span class="n">zpg</span>
</pre></div>
</div>
</section>
<section id="zpkg-command">
<h2><code class="docutils literal notranslate"><span class="pre">zpkg</span></code> Command<a class="headerlink" href="#zpkg-command" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">zpkg</span> <span class="pre">list</span></code>:
Lists all installed packages</p>
<p><code class="docutils literal notranslate"><span class="pre">zpkg</span> <span class="pre">install</span> <span class="pre">package</span> <span class="pre">...</span></code>:
Installs or replaces named packages</p>
<p><code class="docutils literal notranslate"><span class="pre">zpkg</span> <span class="pre">remove</span> <span class="pre">package</span> <span class="pre">...</span></code>:
Removes named packages</p>
<p><code class="docutils literal notranslate"><span class="pre">zpkg</span> <span class="pre">show</span> <span class="pre">package</span> <span class="pre">...</span></code>:
Shows files in named packages</p>
<p><code class="docutils literal notranslate"><span class="pre">zpkg</span> <span class="pre">verify</span> <span class="pre">package</span> <span class="pre">...</span></code>:
Verifies files in named packages</p>
<p><code class="docutils literal notranslate"><span class="pre">zpkg</span> <span class="pre">help</span></code>:
Show this list of options</p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">PandABlocks-rootfs</p>
      </div>
    </a>
    <a class="right-next"
       href="remote.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Updating a PandA via SSH</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-dependencies">Build Dependencies</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuring-config">Configuring <code class="docutils literal notranslate"><span class="pre">CONFIG</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sources">Sources</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#output-files">Output Files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#boot-process">Boot Process</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-sd-for-install">Preparing SD for Install</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#panda-system-first-boot">Panda System First Boot</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#panda-packages-zpkg">PandA Packages (zpkg)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installing-zpkg-files">Installing zpkg Files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#zpkg-command"><code class="docutils literal notranslate"><span class="pre">zpkg</span></code> Command</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  
  <div class="tocsection editthispage">
    <a href="https://github.com/PandABlocks/PandABlocks-rootfs/edit/3.1a5/docs/how-to/building.md">
      <i class="fa-solid fa-pencil"></i>
      
      
        
          Edit on GitHub
        
      
    </a>
  </div>
</div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/how-to/building.md.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Diamond Light Source.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>